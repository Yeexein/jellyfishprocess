<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>水母岛屿通行许可</title>
    <!-- 引入 FingerprintJS 用于生成设备指纹 -->
    <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>

    <style>
        /* --- 全局与基础样式 --- */
        :root {
            --bg-color: #eef2f7;
            /* [更新] 颜色从紫色变更为蓝色 */
            --primary-color: #4A90E2; 
            --text-color: #5b5b5b;
            --shadow-light: #ffffff;
            --shadow-dark: #d5dbe4;
            --inset-shadow-light: rgba(255, 255, 255, 0.7);
            --inset-shadow-dark: rgba(213, 217, 228, 0.7);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden; /* 防止页面切换时出现滚动条 */
        }

        /* --- 页面容器与切换效果 --- */
        .page {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-in-out, visibility 0.5s;
            text-align: center;
        }

        .page.active {
            opacity: 1;
            visibility: visible;
        }

        /* --- 文字淡入效果 --- */
        .fade-in-text {
            animation: fadeIn 1s ease-in-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- 新拟态风格组件 --- */
        .neumorphism-card {
            background: var(--bg-color);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 12px 12px 24px var(--shadow-dark), -12px -12px 24px var(--shadow-light);
            max-width: 600px;
            width: 90%;
        }

        .neumorphism-button,
        .neumorphism-arrow,
        .neumorphism-result-box {
            background: var(--bg-color);
            border: none;
            border-radius: 15px;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            color: var(--text-color);
            cursor: pointer;
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            transition: all 0.2s ease-in-out;
        }

        .neumorphism-button:hover,
        .neumorphism-arrow:hover {
            box-shadow: 2px 2px 5px var(--shadow-dark), -2px -2px 5px var(--shadow-light);
        }

        .neumorphism-button:active,
        .neumorphism-arrow:active {
            box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light);
            color: var(--primary-color);
        }

        /* --- 特定页面样式 --- */
        /* 欢迎页 */
        #welcome-screen h1 {
            font-size: 3em;
            margin-bottom: 50px;
            color: var(--primary-color);
        }

        .neumorphism-arrow {
            position: absolute;
            bottom: 40px;
            right: 40px;
            padding: 20px;
            border-radius: 50%;
        }

        .arrow-icon {
            width: 24px;
            height: 24px;
            stroke: var(--primary-color);
            stroke-width: 3;
            fill: none;
        }

        /* 须知页 */
        #rules-screen h2 {
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        #rules-screen ul {
            list-style: none;
            text-align: left;
            margin-bottom: 30px;
            line-height: 1.8;
            max-width: 450px;
        }
        #rules-screen ul li {
            margin-bottom: 15px;
        }

        /* 答题页 */
        #quiz-screen {
            justify-content: flex-start;
            padding-top: 5vh;
            overflow-y: auto;
        }

        #quiz-form {
            width: 100%;
            max-width: 600px;
        }

        .question {
            background: var(--bg-color);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: left;
            box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light);
        }
        .question p {
            font-weight: bold;
            margin-bottom: 15px;
        }
        .options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .option {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border-radius: 10px;
            transition: all 0.2s ease-in-out;
            flex-basis: calc(33.33% - 10px); /* 三列布局 */
        }
        
        .option input {
            display: none; /* 隐藏原生 radio/checkbox */
        }
        
        .option .custom-check {
            width: 20px;
            height: 20px;
            background: var(--bg-color);
            border-radius: 5px;
            margin-right: 10px;
            display: inline-block;
            box-shadow: inset 2px 2px 4px var(--inset-shadow-dark), inset -2px -2px 4px var(--inset-shadow-light);
            position: relative;
        }
        .option input[type="radio"] + .custom-check {
            border-radius: 50%;
        }
        
        /* [更新] 选中的圆点颜色会自动跟随 --primary-color 变量 */
        .option input:checked + .custom-check::after {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            width: 10px;
            height: 10px;
            background: var(--primary-color);
            border-radius: 2px;
        }
        .option input[type="radio"]:checked + .custom-check::after {
             border-radius: 50%;
        }
        
        .option:hover {
             background: #e4e8ed;
        }
        
        /* 文件上传 */
        .upload-area {
            margin-top: 15px;
            padding: 20px;
            border: 2px dashed var(--shadow-dark);
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s;
            
            /* --- 新增和修改的样式 --- */
            display: flex; /* 使用 Flexbox 布局 */
            flex-direction: column; /* 元素垂直排列 */
            justify-content: center; /* 垂直居中 */
            align-items: center; /* 水平居中 */
            min-height: 120px; /* 给予一个最小高度，防止内容挤压 */
        }

        .upload-area:hover {
            background-color: #e4e8ed;
        }

        #file-list {
            margin-top: 10px;
            font-size: 14px;
        }

        /* 审核页 */
        .loader {
            border: 8px solid var(--bg-color);
            border-top: 8px solid var(--primary-color);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #loading-screen p {
            margin-top: 20px;
            font-size: 1.2em;
        }

        /* 结果页 */
        .result-icon {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        .failure .result-icon {
             color: #ff6b6b;
        }

        #success-screen h2, #failure-screen h2, #cooldown-screen h2 {
            margin-bottom: 20px;
        }
        
        .neumorphism-result-box {
            padding: 20px;
            margin-top: 15px;
            user-select: all;
            cursor: text;
            font-family: 'Courier New', Courier, monospace;
            box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light);
            border-radius: 10px;
            word-break: break-all;
        }
        
        #group-number {
             font-size: 2em;
             letter-spacing: 2px;
             font-weight: bold;
        }

        #copy-button {
            margin-top: 25px;
        }
    </style>
</head>
<body>

    <!-- 欢迎界面 -->
    <div id="welcome-screen" class="page active">
        <h1 class="fade-in-text">欢迎来到水母岛</h1>
        <button id="to-rules" class="neumorphism-arrow" aria-label="进入下一页">
            <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="5" y1="12" x2="19" y2="12"></line>
                <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
        </button>
    </div>

    <!-- 进群须知界面 -->
    <div id="rules-screen" class="page">
        <div class="neumorphism-card fade-in-text">
            <h2>进群须知</h2>
            <p style="margin-bottom: 20px;">请仔细阅读以下条款，后续环节会进行提问。</p>
            <ul>
                <li>1. 本网页并非小手机，也不提供任何小手机的文件或链接。</li>
                <li>2. 群内禁止打卡，打卡达到两次会被踢群，需要找管理员提供使用网页的截屏或者证明二次进群。</li>
                <li>3. 群内禁止使用内置API或商业化的小手机进群，例如Star、Loveme。</li>
                <li>4. 禁止二传网页链接。</li>
            </ul>
            <button id="to-quiz" class="neumorphism-button">已阅并知晓</button>
        </div>
    </div>

    <!-- 答题界面 -->
    <div id="quiz-screen" class="page">
        <form id="quiz-form" novalidate>
            <div class="question fade-in-text">
                <p>1. 你在使用的AI软件/游戏有哪些？ (多选)</p>
                <div class="options">
                    <label class="option"><input type="checkbox" name="q1" value="EVE"><span class="custom-check"></span> EVE</label>
                    <label class="option"><input type="checkbox" name="q1" value="Ephone"><span class="custom-check"></span> Ephone</label>
                    <label class="option"><input type="checkbox" name="q1" value="33聊天室"><span class="custom-check"></span> 33聊天室</label>
                    <label class="option"><input type="checkbox" name="q1" value="koko"><span class="custom-check"></span> koko</label>
                    <label class="option"><input type="checkbox" name="q1" value="jrsy"><span class="custom-check"></span> jrsy</label>
                    <label class="option"><input type="checkbox" name="q1" value="章鱼机"><span class="custom-check"></span> 章鱼机</label>
                    <label class="option"><input type="checkbox" name="q1" value="喵喵机"><span class="custom-check"></span> 喵喵机</label>
                    <label class="option"><input type="checkbox" name="q1" value="糯米机"><span class="custom-check"></span> 糯米机</label>
                    <label class="option"><input type="checkbox" name="q1" value="慕慕"><span class="custom-check"></span> 慕慕</label>
                    <label class="option"><input type="checkbox" name="q1" value="37chat"><span class="custom-check"></span> 37chat</label>
                    <label class="option"><input type="checkbox" name="q1" value="star"><span class="custom-check"></span> Star小手机</label>
                    <label class="option"><input type="checkbox" name="q1" value="loveme"><span class="custom-check"></span> Loveme</label>
                    <label class="option"><input type="checkbox" name="q1" value="SillyTavern"><span class="custom-check"></span> SillyTavern</label>
                    <label class="option"><input type="checkbox" name="q1" value="Tavo"><span class="custom-check"></span> Tavo</label>
                     <label class="option"><input type="checkbox" name="q1" value="Mufy"><span class="custom-check"></span> Mufy</label>
                    <label class="option"><input type="checkbox" name="q1" value="other"><span class="custom-check"></span> 其他</label>
                </div>
            </div>

            <div class="question fade-in-text" style="animation-delay: 0.1s;">
                <p>2. API是什么？ (单选)</p>
                <div class="options">
                    <label class="option"><input type="radio" name="q2" value="wrong1"><span class="custom-check"></span> 一种AI聊天的专用软件</label>
                    <label class="option"><input type="radio" name="q2" value="correct"><span class="custom-check"></span> 用于连接前端和AI模型</label>
                    <label class="option"><input type="radio" name="q2" value="wrong2"><span class="custom-check"></span> 一个包含AI模型的完整程序包</label>
                </div>
            </div>
            
            <div class="question fade-in-text" style="animation-delay: 0.2s;">
                <p>3. HTML怎么使用？ (单选)</p>
                <div class="options">
                    <label class="option"><input type="radio" name="q3" value="wrong1"><span class="custom-check"></span> 放在聊天第一句话里</label>
                    <label class="option"><input type="radio" name="q3" value="correct"><span class="custom-check"></span> 复制粘贴进提示词/世界书</label>
                     <label class="option"><input type="radio" name="q3" value="wrong2"><span class="custom-check"></span> 在软件设置里找到导入按钮</label>
                </div>
            </div>

            <div class="question fade-in-text" style="animation-delay: 0.3s;">
                <p>4. 你是否已经游玩过小手机？ (单选)</p>
                <div class="options">
                    <label class="option"><input type="radio" name="q4" value="correct"><span class="custom-check"></span> 玩过了</label>
                    <label class="option"><input type="radio" name="q4" value="wrong"><span class="custom-check"></span> 还没有</label>
                </div>
            </div>
            
            <div class="question fade-in-text" style="animation-delay: 0.4s;">
                <p>5. 以下哪一项是群内不能做的？ (单选)</p>
                <div class="options">
                    <label class="option"><input type="radio" name="q5" value="correct"><span class="custom-check"></span> 打卡</label>
                    <label class="option"><input type="radio" name="q5" value="wrong1"><span class="custom-check"></span> 聊天</label>
                    <label class="option"><input type="radio" name="q5" value="wrong2"><span class="custom-check"></span> 推荐API</label>
                    <label class="option"><input type="radio" name="q5" value="wrong3"><span class="custom-check"></span> 聊与AI无关话题</label>
                    <label class="option"><input type="radio" name="q5" value="wrong4"><span class="custom-check"></span> 分享自制美化</label>
                </div>
            </div>

            <div class="question fade-in-text" style="animation-delay: 0.5s;">
                <p>6. 本网页是什么？ (单选)</p>
                <div class="options">
                    <label class="option"><input type="radio" name="q6" value="wrong1"><span class="custom-check"></span> 免费小手机</label>
                    <label class="option"><input type="radio" name="q6" value="wrong2"><span class="custom-check"></span> 付费小手机</label>
                    <label class="option"><input type="radio" name="q6" value="correct"><span class="custom-check"></span> 小手机集合工具</label>
                </div>
            </div>

            <div class="question fade-in-text" style="animation-delay: 0.6s;">
                <p>7. 水母岛网页内是否提供小手机链接？ (单选)</p>
                <div class="options">
                    <label class="option"><input type="radio" name="q7" value="wrong"><span class="custom-check"></span> 提供</label>
                    <label class="option"><input type="radio" name="q7" value="correct"><span class="custom-check"></span> 不提供</label>
                </div>
            </div>

            <div class="question fade-in-text" style="animation-delay: 0.7s;">
                <p>8. 请上传1-3张游玩小手机的证明。</p>
                <!-- 使用 div 嵌套来更好地控制文本布局 -->
                <label for="file-upload" class="upload-area">
                    <div style="font-weight: 500;">点击此处选择图片</div>
                    <div style="font-size: 12px; margin-top: 8px;">(包括但不限于主屏幕图标、聊天记录)</div>
                </label>
                <input id="file-upload" type="file" multiple accept="image/*" style="display: none;">
                <div id="file-list"></div>
            </div>
            <button type="submit" class="neumorphism-button" style="width: 100%; padding: 20px; font-size: 18px; margin-top: 20px;">提交审核</button>
        </form>
    </div>

    <!-- 审核中界面 -->
    <div id="loading-screen" class="page">
        <div class="loader"></div>
        <p>审核中，请稍候...</p>
    </div>

    <!-- 成功界面 -->
    <div id="success-screen" class="page">
        <div class="neumorphism-card fade-in-text">
            <svg class="result-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
            <h2>恭喜你，获得进群资格！</h2>
            <p>请复制下面的群号加入：</p>
            <div id="group-number" class="neumorphism-result-box">563191005</div>
            <!-- [新增] 密钥显示 -->
            <p style="margin-top:20px;">进群答案密钥：</p>
            <div class="neumorphism-result-box">乌拉拉乌嘿嘿</div>
            <button id="copy-button" class="neumorphism-button">点击复制群号</button>
        </div>
    </div>

    <!-- 失败界面 -->
    <div id="failure-screen" class="page">
        <div class="neumorphism-card fade-in-text failure">
             <svg class="result-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>
            <h2>抱歉，回答错误</h2>
            <p>您的回答未能通过审核。请在7天冷却期后重试。</p>
        </div>
    </div>
    
    <!-- 冷却界面 -->
    <div id="cooldown-screen" class="page">
         <div class="neumorphism-card fade-in-text failure">
            <svg class="result-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            <!-- [更新] 冷却提示文案和显示内容 -->
            <h2>冷静期未结束</h2>
            <p>请在冷却期过后尝试。冷却期结束于：<br><strong id="cooldown-date" style="font-size: 1.2em; line-height: 2;"></strong></p>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const pages = document.querySelectorAll('.page');
    const toRulesBtn = document.getElementById('to-rules');
    const toQuizBtn = document.getElementById('to-quiz');
    const quizForm = document.getElementById('quiz-form');
    const fileUpload = document.getElementById('file-upload');
    const fileList = document.getElementById('file-list');
    const copyButton = document.getElementById('copy-button');
    const groupNumber = document.getElementById('group-number');
    const cooldownDateEl = document.getElementById('cooldown-date');

    const COOLDOWN_PERIOD = 7 * 24 * 60 * 60 * 1000; // 7天
    let visitorId = '';

    // --- 页面切换逻辑 ---
    function showPage(pageId) {
        pages.forEach(page => {
            page.classList.remove('active');
        });
        const targetPage = document.getElementById(pageId);
        if (targetPage) {
            targetPage.classList.add('active');
        }
    }

    toRulesBtn.addEventListener('click', () => showPage('rules-screen'));
    toQuizBtn.addEventListener('click', () => showPage('quiz-screen'));

    // --- 文件上传显示 ---
    fileUpload.addEventListener('change', () => {
        fileList.innerHTML = '';
        if (fileUpload.files.length > 0) {
            const files = Array.from(fileUpload.files).slice(0, 3); // 最多显示3个
            files.forEach(file => {
                const fileItem = document.createElement('p');
                fileItem.textContent = `已选择: ${file.name}`;
                fileList.appendChild(fileItem);
            });
        }
    });

    // --- 答题逻辑 ---
    quizForm.addEventListener('submit', (e) => {
        e.preventDefault();

        // [新增] 提交前检查所有题目是否都已回答
        const isFormComplete = checkFormCompleteness();
        if (!isFormComplete) {
            alert("请回答所有问题并上传证明文件后再提交！");
            return; // 阻止提交
        }

        showPage('loading-screen');

        setTimeout(() => {
            const result = validateQuiz();
            if (result.passed) {
                showPage('success-screen');
            } else {
                const now = new Date().getTime();
                localStorage.setItem(visitorId, now);
                showPage('failure-screen');
            }
        }, 5000); // 模拟5秒审核
    });
    
    // [新增] 检查表单完整性的函数
    function checkFormCompleteness() {
        // 检查多选题 (至少选一个)
        if (document.querySelectorAll('input[name="q1"]:checked').length === 0) return false;
        
        // 检查所有单选题
        const radioQuestions = ['q2', 'q3', 'q4', 'q5', 'q6', 'q7'];
        for (const qName of radioQuestions) {
            if (!document.querySelector(`input[name="${qName}"]:checked`)) {
                return false;
            }
        }

        // 检查文件是否上传
        if (fileUpload.files.length === 0) return false;

        return true; // 所有检查通过
    }

    function validateQuiz() {
        const q1Answers = Array.from(document.querySelectorAll('input[name="q1"]:checked')).map(el => el.value);
        if (q1Answers.length === 1 && (q1Answers.includes('star') || q1Answers.includes('loveme'))) {
            return { passed: false, reason: 'Q1' };
        }

        const correctAnswers = {
            q2: 'correct', q3: 'correct', q4: 'correct',
            q5: 'correct', q6: 'correct', q7: 'correct'
        };

        for (const q in correctAnswers) {
            const userAnswer = document.querySelector(`input[name="${q}"]:checked`);
            if (!userAnswer || userAnswer.value !== correctAnswers[q]) {
                return { passed: false, reason: (`${q} wrong`) };
            }
        }
        
        return { passed: true };
    }
    
    // --- 复制功能 ---
    copyButton.addEventListener('click', () => {
        navigator.clipboard.writeText(groupNumber.textContent).then(() => {
            copyButton.textContent = '群号复制成功!';
            setTimeout(() => {
                copyButton.textContent = '点击复制群号';
            }, 2000);
        }).catch(err => {
            console.error('复制失败: ', err);
            copyButton.textContent = '复制失败';
        });
    });

    // --- 冷却期逻辑 ---
    async function checkCooldown() {
        if (window.FingerprintJS) {
            const fp = await FingerprintJS.load();
            const result = await fp.get();
            visitorId = result.visitorId;

            const lastAttemptTime = localStorage.getItem(visitorId);
            if (lastAttemptTime) {
                const now = new Date().getTime();
                const timePassed = now - parseInt(lastAttemptTime, 10);
                
                if (timePassed < COOLDOWN_PERIOD) {
                    // [更新] 显示冷却结束日期而不是倒计时
                    displayCooldownEndDate(parseInt(lastAttemptTime, 10));
                    showPage('cooldown-screen');
                    return true;
                }
            }
        }
        return false;
    }
    
    // [更新] 新函数，用于计算并显示冷却结束日期
    function displayCooldownEndDate(startTime) {
        const endTime = startTime + COOLDOWN_PERIOD;
        const endDate = new Date(endTime);
        // 使用 toLocaleString 来显示为本地化的日期和时间格式
        cooldownDateEl.textContent = endDate.toLocaleString('zh-CN', {
            year: 'numeric', month: 'long', day: 'numeric', 
            hour: '2-digit', minute: '2-digit', second: '2-digit'
        });
    }

    // --- 初始化 ---
    async function init() {
         const onCooldown = await checkCooldown();
         if (!onCooldown) {
            showPage('welcome-screen');
         }
    }
    
    init();

});
</script>

</body>
</html>